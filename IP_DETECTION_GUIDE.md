# ğŸ¯ ç½‘ç»œæ£€æµ‹ç²¾å‡† IP è·å–æ–¹æ¡ˆ

## é—®é¢˜åˆ†æ

æ‚¨éœ€è¦ç²¾å‡†è·å–ä»¥ä¸‹4ç§ç½‘ç»œåœºæ™¯ä¸‹çš„IPï¼š
- ğŸ‡¨ğŸ‡³ **å›½å†…æµ‹è¯•** - è®¿é—®å›½å†…ç«™ç‚¹çš„å‡ºå£IP
- ğŸŒ **å›½å¤–æµ‹è¯•** - è®¿é—®å›½å¤–ç«™ç‚¹çš„å‡ºå£IP  
- â˜ï¸ **CloudFlare CDN** - è®¿é—®CFåŠ é€Ÿç«™ç‚¹çš„è½åœ°IP
- ğ• **Twitter/X** - è®¿é—®æ¨ç‰¹çš„å‡ºå£IP

## è§£å†³æ–¹æ¡ˆæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å‰ç«¯ (public/index.html)             â”‚
â”‚  ç½‘ç»œæ£€æµ‹æ¨¡å— - è‡ªåŠ¨åŠ è½½å¹¶åˆ·æ–°              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“ GET /api/network-info
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          API (api/index.js)                  â”‚
â”‚  handleNetworkInfo() å¹¶è¡Œæ‰§è¡Œ5ä¸ªæµ‹è¯•        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“ detectIP(testPoint)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ ¸å¿ƒåº“ (lib/all.js)                  â”‚
â”‚  â”Œâ”€ fetchIP() - è·å–åŸå§‹å“åº”                 â”‚
â”‚  â””â”€ parseIPFromResponse() - ç²¾å‡†æå–IP      â”‚
â”‚     â”œâ”€ ç­–ç•¥1: CloudFlare trace æ ¼å¼         â”‚
â”‚     â”œâ”€ ç­–ç•¥2: JSON æ ¼å¼ (å¤šå­—æ®µæœç´¢)        â”‚
â”‚     â”œâ”€ ç­–ç•¥3: çº¯æ–‡æœ¬æ ¼å¼                    â”‚
â”‚     â”œâ”€ ç­–ç•¥4: Script æ ‡ç­¾å†…å®¹               â”‚
â”‚     â”œâ”€ ç­–ç•¥5: HTML æ ‡ç­¾å†…å®¹                 â”‚
â”‚     â”œâ”€ ç­–ç•¥6: æ–‡æœ¬æ¨¡å¼ (å«ä¸­æ–‡)             â”‚
â”‚     â””â”€ ç­–ç•¥7: å…œåº•æ­£åˆ™æå–                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“ queryIP(ip)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      GeoIP æŸ¥è¯¢ (maxmind database)          â”‚
â”‚  è·å–: å›½å®¶ã€åœ°åŒºã€å¤§æ´²ç­‰åœ°ç†ä¿¡æ¯           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      å‰ç«¯æ¸²æŸ“ - å±•ç¤ºæ‰€æœ‰ç½‘ç»œä¿¡æ¯             â”‚
â”‚  æ˜¾ç¤º: IPã€å›½å®¶ã€å¤§æ´²ã€æµ‹è¯•æºç­‰              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## IP æå– 7 å±‚ç­–ç•¥è¯¦è§£

### ç­–ç•¥1ï¸âƒ£: CloudFlare Trace æ ¼å¼
```
è¯·æ±‚: https://www.cloudflare.com/cdn-cgi/trace
å“åº”: ip=1.2.3.4
æå–: ä½¿ç”¨æ­£åˆ™ /ip=([^\n\r]+)/
```

### ç­–ç•¥2ï¸âƒ£: JSON æ ¼å¼ (æ™ºèƒ½å­—æ®µæœç´¢)
```javascript
// æ”¯æŒå¤šå±‚åµŒå¥—å’Œå¤šç§å­—æ®µå
æ”¯æŒå­—æ®µ: ip, query, ip_address, origin, client_ip, clientIP
         remote_ip, remoteIP, your_ip, yourIp, visitor_ip

ç¤ºä¾‹:
{ "ip": "1.2.3.4" }
{ "query": "1.2.3.4" }
{ "data": { "ip": "1.2.3.4" } }
{ "result": { "client_ip": "1.2.3.4" } }
```

### ç­–ç•¥3ï¸âƒ£: çº¯æ–‡æœ¬æ ¼å¼
```
è¯·æ±‚: https://ipv4.icanhazip.com/
å“åº”: 1.2.3.4
æå–: ç›´æ¥ trim() å’ŒéªŒè¯
```

### ç­–ç•¥4ï¸âƒ£: Script æ ‡ç­¾å†…å®¹
```html
<script>
  var ip = "1.2.3.4";
  window.clientIP = "1.2.3.4";
  console.log(ip);
</script>

æå–: æ­£åˆ™æ¨¡å¼
- /ip["\s:=]+([0-9.]+)/i
- /clientip["\s:=]+([0-9.]+)/i
- /var\s+ip\s*=\s*["\']([0-9.]+)/i
```

### ç­–ç•¥5ï¸âƒ£: HTML æ ‡ç­¾å†…å®¹
```html
<p>æ‚¨çš„IPæ˜¯: 1.2.3.4</p>
<div>æ¥è‡ª: 1.2.3.4</div>
<span class="ip">1.2.3.4</span>

æå–: HTML æ ‡ç­¾å†…çš„IP
```

### ç­–ç•¥6ï¸âƒ£: æ–‡æœ¬æ¨¡å¼ (å«ä¸­æ–‡)
```
æ”¯æŒçš„æ¨¡å¼:
- clientip, client_ip, client-ip
- remote_ip, remote-ip
- visitor_ip, visitor-ip
- your_ip, your-ip
- x_forwarded_for, x-forwarded-for
- æ‚¨çš„IP
- æ¥è‡ªIP
- æºIP
- å‡ºå£IP
- æ£€æµ‹åˆ°IP
- åœ°å€IP
```

### ç­–ç•¥7ï¸âƒ£: å…œåº•æ­£åˆ™æå–
```javascript
// å½“å…¶ä»–ç­–ç•¥éƒ½å¤±è´¥æ—¶ï¼Œç›´æ¥æå–ç¬¬ä¸€ä¸ªæœ‰æ•ˆIP
const ipMatch = data.match(/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})/);
```

## å½“å‰é…ç½®çš„ 5 ä¸ªæµ‹è¯•ç‚¹

### 1. ğŸ‡¨ğŸ‡³ å›½å†…æµ‹è¯• (å›½å†…ç½‘ç«™)
```javascript
{
  key: 'domestic',
  urls: [
    'https://www.baidu.com/',
    'https://www.163.com/',
    'https://api.bilibili.com/x/web-interface/nav',
    'https://www.qq.com/',
    'https://www.taobao.com/'
  ],
  headers: {
    'Referer': 'https://www.baidu.com/',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
  }
}
```

### 2. ğŸŒ å›½å¤–æµ‹è¯• (å›½é™…ç½‘ç«™)
```javascript
{
  key: 'foreign',
  urls: [
    'https://www.google.com/',
    'https://www.facebook.com/',
    'https://www.youtube.com/',
    'https://www.github.com/',
    'https://ipv4.icanhazip.com/',        // API å¤‡ç”¨
    'https://api.ipify.org?format=json'   // API å¤‡ç”¨
  ],
  headers: {
    'Referer': 'https://www.google.com/',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
  }
}
```

### 3. â˜ï¸ CloudFlare CDN
```javascript
{
  key: 'cloudflare',
  urls: [
    'https://www.cloudflare.com/cdn-cgi/trace',  // å®˜æ–¹ trace
    'https://one.one.one.one/doh',               // DNS over HTTPS
    'https://example.com/'                       // å¤‡ç”¨
  ],
  headers: { 'Accept': '*/*' }
}
```

### 4. ğ• Twitter/X
```javascript
{
  key: 'twitter',
  urls: [
    'https://x.com/',
    'https://twitter.com/',
    'https://api.twitter.com/1.1/account/verify_credentials.json'
  ],
  headers: {
    'Referer': 'https://x.com/',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
  }
}
```

### 5. ğŸ” IP111å›½å†…æ£€æµ‹
```javascript
{
  key: 'ip111',
  urls: [
    'https://ip111.cn/'
  ],
  headers: {
    'Referer': 'https://ip111.cn/',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
  }
}
```

## å·¥ä½œæµç¨‹

### API è°ƒç”¨æµç¨‹
```
1. å‰ç«¯ç‚¹å‡» "ğŸ”„ åˆ·æ–°" æŒ‰é’®
   â†“
2. è°ƒç”¨ GET /api/network-info
   â†“
3. æœåŠ¡ç«¯ handleNetworkInfo() å¹¶è¡Œæ‰§è¡Œ 5 ä¸ª detectIP()
   â†“
4. æ¯ä¸ª detectIP() å¤„ç†:
   - éå†æµ‹è¯• URL åˆ—è¡¨
   - è°ƒç”¨ fetchIP() è·å–åŸå§‹å“åº”
   - è°ƒç”¨ parseIPFromResponse() ç”¨ 7 å±‚ç­–ç•¥æå– IP
   - è°ƒç”¨ queryIP() æŸ¥è¯¢åœ°ç†ä½ç½®
   - å¦‚æœæˆåŠŸåˆ™è¿”å›ï¼Œå¦åˆ™å°è¯•ä¸‹ä¸€ä¸ª URL
   â†“
5. è¿”å› JSON å“åº”ç»™å‰ç«¯
   {
     "success": true,
     "data": {
       "domestic": { "ip": "1.2.3.4", "country_name": "ä¸­å›½", ... },
       "foreign": { "ip": "5.6.7.8", "country_name": "ç¾å›½", ... },
       "cloudflare": { "ip": "9.10.11.12", "country_name": "ç¾å›½", ... },
       "twitter": { "ip": "13.14.15.16", "country_name": "ç¾å›½", ... },
       "ip111": { "ip": "17.18.19.20", "country_name": "æ–°åŠ å¡", ... },
       "client_ip": "203.0.113.1"
     },
     "timestamp": "2024-11-14T..."
   }
   â†“
6. å‰ç«¯ renderNetworkInfo() æ¸²æŸ“å¡ç‰‡å±•ç¤º
```

## å‰ç«¯æ˜¾ç¤ºä¼˜åŒ–

æ¯ä¸ªæµ‹è¯•ç»“æœå¡ç‰‡æ˜¾ç¤º:
- âœ… **IP åœ°å€** (åŠ ç²—ã€è“è‰²)
- ğŸ“ **å›½å®¶/åœ°åŒº** (åœ°ç†ä½ç½®)
- ğŸ·ï¸ **å›½å®¶ä»£ç ** (ISO 3166-1)
- ğŸŒ **å¤§æ´²** (æ‰€å±æ´²)
- ğŸ”— **æµ‹è¯•æº** (ä½¿ç”¨çš„å…·ä½“URL)

åº•éƒ¨æ˜¾ç¤º:
- ğŸ“¡ **æ‚¨çš„ç›´è¿ IP** (æœåŠ¡å™¨ç«¯æ£€æµ‹çš„æºIP)

## æ•…éšœæ’æŸ¥

### é—®é¢˜1: "æš‚æ—¶æ— æ³•è·å–ä¿¡æ¯"

**åŸå› **: æ‰€æœ‰ URL éƒ½æ— æ³•æˆåŠŸæå– IP

**è§£å†³**:
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—: `console.log` è¾“å‡º
3. å¢åŠ å¤‡ç”¨ URL
4. å¢åŠ è¶…æ—¶æ—¶é—´ (å½“å‰ 10s)

### é—®é¢˜2: IP ä¸å‡†ç¡®

**åŸå› **: 
- ä½¿ç”¨äº†ä»£ç†/VPN
- æµ‹è¯• URL è¢«é‡å®šå‘
- å“åº”æ ¼å¼å˜åŒ–

**è§£å†³**:
1. æ·»åŠ è‡ªå®šä¹‰è¯·æ±‚å¤´ (Referer, Accept ç­‰)
2. æ›´æ–° IP æå–æ­£åˆ™
3. å¢åŠ æ–°çš„æµ‹è¯• URL

### é—®é¢˜3: æŸäº›æµ‹è¯•ç‚¹ç»å¸¸å¤±è´¥

**åŸå› **: ç½‘ç«™å¯èƒ½é˜»æ­¢è‡ªåŠ¨è¯·æ±‚

**è§£å†³**:
1. å¢åŠ  User-Agent å¤šæ ·æ€§
2. æ·»åŠ æ›´å¤šè‡ªå®šä¹‰è¯·æ±‚å¤´
3. ä½¿ç”¨ API å¤‡ç”¨æº
4. å¢åŠ é‡è¯•æœºåˆ¶

## æ€§èƒ½ä¼˜åŒ–

å½“å‰è®¾ç½®:
- â±ï¸ **è¶…æ—¶æ—¶é—´**: 10 ç§’
- ğŸ“¦ **æœ€å¤§å“åº”**: 100 KB
- ğŸ”„ **å¹¶å‘æ•°**: 5 ä¸ªæµ‹è¯•ç‚¹å¹¶è¡Œ
- ğŸ¯ **æå–ç­–ç•¥**: 7 å±‚é€’è¿›

é¢„æœŸæ€§èƒ½:
- ğŸš€ **å¹³å‡å“åº”æ—¶é—´**: 3-8 ç§’
- ğŸ“Š **æˆåŠŸç‡**: 95%+ (å…·æœ‰å¤š URL å¤‡ç”¨)
- ğŸ” **å•ç‚¹æ•…éšœè½¬ç§»**: <2 ç§’

## æ‰©å±•å»ºè®®

### å¢åŠ æµ‹è¯•ç‚¹
```javascript
{ 
  key: 'alibaba',
  name: 'é˜¿é‡Œäº‘',
  urls: ['https://www.alibaba.com/', ...],
  headers: { ... }
}
```

### æ·»åŠ å»¶è¿Ÿæ£€æµ‹
```javascript
// åœ¨ API è¿”å›ä¸­æ·»åŠ å»¶è¿Ÿä¿¡æ¯
{
  ip: "1.2.3.4",
  responseTime: 234,  // æ¯«ç§’
  ...
}
```

### å®ç°å†å²è®°å½•
```javascript
// å­˜å‚¨å†å²æ£€æµ‹æ•°æ®
localStorage.setItem('networkHistory', JSON.stringify({
  timestamp: new Date().toISOString(),
  results: data,
  ...
}))
```

---

## ä»£ç ä½ç½®

| æ–‡ä»¶ | åŠŸèƒ½ | å…³é”®å‡½æ•° |
|------|------|---------|
| `api/index.js` | API è·¯ç”± | `handleNetworkInfo()` |
| `lib/all.js` | æ ¸å¿ƒæ£€æµ‹ | `detectIP()`, `fetchIP()`, `parseIPFromResponse()` |
| `public/index.html` | å‰ç«¯å±•ç¤º | `detectNetworkInfo()`, `renderNetworkInfo()` |

## å¿«é€Ÿå¼€å§‹

### 1. æœ¬åœ°æµ‹è¯•
```bash
npm run dev
# è®¿é—® http://localhost:3000
# ç‚¹å‡» "ğŸ”„ åˆ·æ–°" æŒ‰é’®æµ‹è¯•
```

### 2. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
```bash
# åœ¨æ§åˆ¶å°çœ‹åˆ°è¯¦ç»†çš„ IP æå–è¿‡ç¨‹
[IPæå–] âœ… CloudFlare trace æ ¼å¼: 1.2.3.4
[IPæå–] âœ… JSON æ ¼å¼: 5.6.7.8
```

### 3. éƒ¨ç½²åˆ° Vercel
```bash
git add .
git commit -m "ä¼˜åŒ–: ç²¾å‡†IPæ£€æµ‹å’Œå‰ç«¯æ˜¾ç¤º"
git push
vercel --prod
```

---

*æœ€åæ›´æ–°: 2024-11-14*
