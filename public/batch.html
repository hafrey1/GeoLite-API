<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoLite API - æ‰¹é‡æµ‹è¯•å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .input-section {
            margin-bottom: 30px;
        }
        
        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
            resize: vertical;
            box-sizing: border-box;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background: #0056b3;
        }
        
        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .btn.secondary {
            background: #6c757d;
        }
        
        .btn.success {
            background: #28a745;
        }
        
        .results {
            margin-top: 30px;
        }
        
        .stats {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .stat-item {
            text-align: center;
            margin: 5px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 14px;
            overflow-x: auto;
            display: block;
            white-space: nowrap;
        }
        
        .results-table thead,
        .results-table tbody {
            display: table;
            width: 100%;
            table-layout: fixed;
        }
        
        .results-table th,
        .results-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
            word-wrap: break-word;
        }
        
        .results-table th {
            background: #f8f9fa;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        .status-success {
            color: #28a745;
            font-weight: bold;
        }
        
        .status-error {
            color: #dc3545;
            font-weight: bold;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border: 1px solid #f5c6cb;
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background: #f8f9fa;
            border-radius: 2px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007bff, #28a745);
            transition: width 0.3s ease;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .controls {
                justify-content: center;
            }
            
            .stats {
                justify-content: center;
            }
            
            .results-table {
                font-size: 12px;
            }
            
            .results-table th,
            .results-table td {
                padding: 6px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª GeoLite API æ‰¹é‡æµ‹è¯•å·¥å…·</h1>
            <p>æ‰¹é‡æŸ¥è¯¢IPåœ°å€å’ŒåŸŸåçš„åœ°ç†ä½ç½®ä¿¡æ¯</p>
        </div>

        <div class="input-section">
            <h3>ğŸ“ è¾“å…¥IPåœ°å€å’ŒåŸŸåï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰ï¼š</h3>
            <textarea id="inputText" placeholder="è¯·è¾“å…¥IPåœ°å€æˆ–åŸŸåï¼Œæ¯è¡Œä¸€ä¸ªï¼Œä¾‹å¦‚ï¼š
8.8.8.8
google.com
github.com
baidu.com
114.114.114.114
cloudflare.com
youtube.com
facebook.com
twitter.com"></textarea>

            <div class="controls">
                <button class="btn" onclick="startBatchQuery()" id="queryBtn">
                    ğŸš€ å¼€å§‹æ‰¹é‡æŸ¥è¯¢
                </button>
                <button class="btn secondary" onclick="loadSampleData()">
                    ğŸ“„ åŠ è½½ç¤ºä¾‹æ•°æ®
                </button>
                <button class="btn secondary" onclick="clearResults()">
                    ğŸ—‘ï¸ æ¸…ç©ºç»“æœ
                </button>
                <label>
                    <input type="checkbox" id="exportCsv"> ç›´æ¥å¯¼å‡ºCSVæ ¼å¼
                </label>
            </div>
            <div class="progress-bar" id="progressBar" style="display: none;">
                <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
            </div>
        </div>

        <div class="results" id="results" style="display: none;">
            <h3>ğŸ“Š æŸ¥è¯¢ç»“æœ</h3>
            <div class="stats" id="stats"></div>
            <div id="resultsContent"></div>
        </div>
    </div>

    <script>
        let currentResults = null;

        // åŠ è½½ç¤ºä¾‹æ•°æ®
        function loadSampleData() {
            const sampleData = `8.8.8.8
google.com
cloudflare.com
baidu.com
114.114.114.114
github.com
youtube.com
facebook.com
twitter.com
208.67.222.222
amazon.com
microsoft.com
apple.com
35.229.225.152
104.199.178.70
34.80.109.47
35.221.203.90
35.221.254.236
34.92.17.55
34.92.69.6
34.150.38.74
34.92.20.51
35.220.133.61
34.146.177.122
35.189.147.253
35.194.107.163
34.84.33.5
34.146.175.7
34.97.77.117
34.97.14.238
34.97.151.28
34.97.76.21
34.97.75.208
34.64.142.111
34.64.197.141
34.64.111.181
34.64.153.125
34.64.75.27
34.93.10.146
35.200.143.183
34.93.118.120
35.200.183.209
34.93.102.253
34.131.40.9
34.131.211.247
34.131.201.63
34.131.180.63
34.131.78.219
34.87.56.130
35.186.145.36
35.240.226.116
34.87.108.57
34.126.64.172
34.101.103.120
34.101.251.172
34.101.237.228
34.101.225.99
34.101.77.131
34.116.127.89
35.201.23.39
35.197.161.138
35.244.113.19
35.201.16.163
34.126.200.44
34.129.106.76
34.129.255.65
34.126.206.247
34.129.68.226
34.116.167.55
34.116.140.14
34.118.115.98
34.118.126.53
34.118.88.136
35.228.114.153
35.228.159.222
35.228.50.108
35.228.89.233
35.228.15.233
34.51.134.215
34.51.141.173
34.51.134.3
34.51.134.45
34.51.138.174
34.175.139.26
34.175.242.116
34.175.193.23
34.175.36.196
34.175.176.3
104.199.6.64
34.78.213.130
35.205.33.30
35.205.125.111
35.187.27.174
34.89.121.226
35.197.249.117
34.105.244.177
35.242.151.51
35.189.120.213
34.107.67.56
34.107.105.29
34.141.63.48
34.141.29.11
34.107.50.245
34.91.152.13
35.204.79.99
34.90.129.65
34.90.22.40
35.204.21.106
34.65.99.193
34.65.169.161
34.65.220.226
34.65.154.35
34.65.113.10
34.154.228.146
34.154.134.9
34.154.6.50
34.154.235.42
34.154.116.236
34.155.255.24
34.163.0.128
34.163.201.22
34.155.160.66
34.163.184.98
34.166.37.167
34.166.6.76
34.166.23.95
34.166.32.165
34.166.25.155
34.95.32.67
34.152.52.229
35.203.44.141
35.203.42.193
35.203.18.247
34.130.100.152
34.124.121.68
34.130.131.203
34.130.151.32
34.124.118.133
34.51.19.57
34.51.17.120
34.51.12.206
34.51.23.163
34.51.22.207
35.199.77.203
35.198.52.22
35.198.0.15
35.247.212.140
34.95.239.160
34.176.79.229
34.176.63.168
34.176.193.97
34.176.201.194
34.176.217.158
34.72.28.29
34.67.234.134
34.67.6.157
34.72.239.218
34.71.242.81
34.74.216.163
34.75.166.194
104.196.6.24
34.73.50.6
35.237.45.20
35.245.110.238
34.85.182.28
34.150.213.121
34.150.171.115
34.145.160.237
34.162.19.169
34.162.19.132
34.162.62.105
34.162.110.164
34.162.215.178
34.174.23.23
34.174.126.36
34.174.74.106
34.174.143.176
34.174.126.91
35.247.10.221
35.233.208.195
34.82.253.59
35.247.95.52
34.82.254.46
35.235.83.92
34.94.230.251
34.94.60.44
34.102.102.81
34.94.40.175
34.106.215.166
34.106.204.197
34.106.119.245
34.106.60.77
34.106.53.183
34.125.243.211
34.125.107.65
34.125.139.78
34.125.158.25
34.125.152.20
netflix.com`;
            document.getElementById('inputText').value = sampleData;
        }

        // æ˜¾ç¤ºè¿›åº¦æ¡
        function showProgress() {
            document.getElementById('progressBar').style.display = 'block';
            animateProgress();
        }

        // è¿›åº¦æ¡åŠ¨ç”»
        function animateProgress() {
            const progressFill = document.getElementById('progressFill');
            let width = 0;
            const interval = setInterval(() => {
                if (width >= 90) {
                    clearInterval(interval);
                } else {
                    width += Math.random() * 10;
                    progressFill.style.width = width + '%';
                }
            }, 200);
        }

        // éšè—è¿›åº¦æ¡
        function hideProgress() {
            document.getElementById('progressBar').style.display = 'none';
            document.getElementById('progressFill').style.width = '0%';
        }

        // å¼€å§‹æ‰¹é‡æŸ¥è¯¢
        async function startBatchQuery() {
            const inputText = document.getElementById('inputText').value.trim();
            if (!inputText) {
                alert('è¯·è¾“å…¥IPåœ°å€æˆ–åŸŸå');
                return;
            }

            const queryBtn = document.getElementById('queryBtn');
            const resultsDiv = document.getElementById('results');

            queryBtn.disabled = true;
            queryBtn.innerHTML = 'â³ æŸ¥è¯¢ä¸­...';
            resultsDiv.style.display = 'block';
            showProgress();

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('resultsContent').innerHTML = 
                '<div class="loading">ğŸ” æ­£åœ¨æ‰¹é‡æŸ¥è¯¢ä¸­ï¼Œè¯·ç¨å€™...</div>';

            try {
                const inputs = inputText.split('\n')
                    .map(line => line.trim())
                    .filter(line => line);
                    
                const exportCsv = document.getElementById('exportCsv').checked;

                const response = await fetch('/api/batch', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        inputs: inputs,
                        format: exportCsv ? 'csv' : 'json'
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                if (exportCsv) {
                    // å¤„ç†CSVä¸‹è½½
                    const csvData = await response.text();
                    const blob = new Blob([csvData], { type: 'text/csv' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `geoip-results-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.csv`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);

                    document.getElementById('resultsContent').innerHTML = 
                        '<div class="loading">âœ… CSVæ–‡ä»¶å·²ä¸‹è½½å®Œæˆï¼</div>';
                } else {
                    const data = await response.json();

                    if (data.success) {
                        currentResults = data;
                        displayResults(data);
                    } else {
                        throw new Error(data.message || data.error || 'æŸ¥è¯¢å¤±è´¥');
                    }
                }
            } catch (error) {
                console.error('æŸ¥è¯¢é”™è¯¯:', error);
                document.getElementById('resultsContent').innerHTML =
                    `<div class="error">âŒ æŸ¥è¯¢å¤±è´¥ï¼š${error.message}</div>`;
            } finally {
                queryBtn.disabled = false;
                queryBtn.innerHTML = 'ğŸš€ å¼€å§‹æ‰¹é‡æŸ¥è¯¢';
                hideProgress();
            }
        }

        // æ˜¾ç¤ºæŸ¥è¯¢ç»“æœ
        function displayResults(data) {
            const stats = data.stats || data.statistics || {};
            const results = data.data || [];

            // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
            document.getElementById('stats').innerHTML = `
                <div class="stat-item">
                    <div class="stat-value">${stats.total || results.length}</div>
                    <div>æ€»æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" style="color: #28a745;">${stats.success || 0}</div>
                    <div>æˆåŠŸ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" style="color: #dc3545;">${stats.error || 0}</div>
                    <div>å¤±è´¥</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.processing_time || stats.processing_time_ms || '0'}ms</div>
                    <div>å¤„ç†æ—¶é—´</div>
                </div>
                <div class="stat-item">
                    <button class="btn success" onclick="exportToCsv()">ğŸ“¥ å¯¼å‡ºCSV</button>
                </div>
            `;

            // æ˜¾ç¤ºè¯¦ç»†ç»“æœè¡¨æ ¼
            let tableHTML = `
                <table class="results-table">
                    <thead>
                        <tr>
                            <th style="width: 50px;">#</th>
                            <th style="width: 150px;">è¾“å…¥</th>
                            <th style="width: 80px;">ç±»å‹</th>
                            <th style="width: 130px;">IPåœ°å€</th>
                            <th style="width: 80px;">å›½å®¶ä»£ç </th>
                            <th style="width: 100px;">å›½å®¶åç§°</th>
                            <th style="width: 80px;">æ´²ä»£ç </th>
                            <th style="width: 80px;">çŠ¶æ€</th>
                            <th style="width: 200px;">ä¿¡æ¯</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            results.forEach((result, index) => {
                const statusClass = result.status === 'success' ? 'status-success' : 'status-error';
                const ip = result.ip || result.resolved_ip || '-';
                const message = result.message || (result.status === 'success' ? 'æŸ¥è¯¢æˆåŠŸ' : 'æŸ¥è¯¢å¤±è´¥');

                tableHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td title="${result.input}">${result.input}</td>
                        <td>${result.type || 'unknown'}</td>
                        <td>${ip}</td>
                        <td>${result.country_code || '-'}</td>
                        <td>${result.country_name || '-'}</td>
                        <td>${result.continent_code || '-'}</td>
                        <td class="${statusClass}">${result.status || 'error'}</td>
                        <td title="${message}">${message}</td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
            `;

            document.getElementById('resultsContent').innerHTML = tableHTML;
        }

        // å¯¼å‡ºCSV
        function exportToCsv() {
            if (!currentResults) {
                alert('æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®');
                return;
            }

            const results = currentResults.data || [];
            const headers = ['åºå·', 'è¾“å…¥', 'ç±»å‹', 'IPåœ°å€', 'è§£æIP', 'å›½å®¶ä»£ç ', 'å›½å®¶åç§°', 'æ´²ä»£ç ', 'æ´²åç§°', 'çŠ¶æ€', 'ä¿¡æ¯'];
            const csvData = [headers.join(',')];

            results.forEach((result, index) => {
                const row = [
                    index + 1,
                    `"${(result.input || '').replace(/"/g, '""')}"`,
                    `"${(result.type || '').replace(/"/g, '""')}"`,
                    `"${(result.ip || '').replace(/"/g, '""')}"`,
                    `"${(result.resolved_ip || '').replace(/"/g, '""')}"`,
                    `"${(result.country_code || '').replace(/"/g, '""')}"`,
                    `"${(result.country_name || '').replace(/"/g, '""')}"`,
                    `"${(result.continent_code || '').replace(/"/g, '""')}"`,
                    `"${(result.continent_name || '').replace(/"/g, '""')}"`,
                    `"${(result.status || '').replace(/"/g, '""')}"`,
                    `"${(result.message || '').replace(/"/g, '""')}"`
                ];
                csvData.push(row.join(','));
            });

            const csvContent = csvData.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `geoip-results-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // æ¸…ç©ºç»“æœ
        function clearResults() {
            document.getElementById('inputText').value = '';
            document.getElementById('results').style.display = 'none';
            currentResults = null;
            hideProgress();
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('GeoLite API æ‰¹é‡æµ‹è¯•å·¥å…·å·²å°±ç»ª');
        });
    </script>
</body>
</html>
