<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoLite API - IPåœ°ç†ä½ç½®æŸ¥è¯¢æœåŠ¡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #2c3e50;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 50px;
            padding: 10px 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.1;
        }

        .header h1 {
            font-size: 3.5em;
            margin-bottom: 20px;
            font-weight: 800;
            letter-spacing: -1px;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
            margin: 10px 0;
            position: relative;
            z-index: 1;
        }

        /* å•åˆ—å¸ƒå±€ */
        .modules-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
            margin-bottom: 50px;
        }

        .module {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }

        .module:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
        }

        .module-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-bottom: 5px solid rgba(255, 255, 255, 0.2);
        }

        .module-header h3 {
            font-size: 1.3em;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .module-content {
            padding: 25px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .nav-tabs {
            display: none;
        }

        .nav-tab {
            display: none;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .feature {
            background: white;
            padding: 30px;
            border-radius: 15px;
            border-left: 5px solid #667eea;
            margin: 25px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .feature:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .feature h3 {
            margin-bottom: 20px;
            color: #667eea;
            font-size: 1.3em;
        }

        .feature ul {
            list-style: none;
            padding: 0;
        }

        .feature li {
            padding: 12px 0;
            display: flex;
            align-items: flex-start;
        }

        .feature li::before {
            content: 'âœ“';
            color: #667eea;
            font-weight: bold;
            margin-right: 12px;
            font-size: 1.2em;
        }

        .api-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 25px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }

        .endpoint {
            background: #f5f7fa;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            border-left: 4px solid #667eea;
            color: #2c3e50;
            overflow-x: auto;
        }

        .example {
            background: #f9fafb;
            border: 2px solid #e9ecef;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            transition: all 0.3s ease;
        }

        .example:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 14px;
            line-height: 1.5;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 10px 5px;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        /* å•ä¸ªæŸ¥è¯¢éƒ¨åˆ† */
        .query-section {
            background: transparent;
            padding: 0;
            border-radius: 0;
            box-shadow: none;
        }

        .query-section h2 {
            display: none;
        }

        .query-section p {
            margin-bottom: 20px;
            color: #666;
            font-size: 0.9em;
        }

        .query-input {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 15px 0;
            flex-wrap: nowrap;
            align-items: stretch;
        }

        .query-input input {
            flex: 1;
            min-width: 0;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 0.9em;
            transition: all 0.3s ease;
            background: #f9fafb;
        }

        .query-input input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .query-result {
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 8px;
            border-left: 4px solid #667eea;
            max-height: 300px;
            overflow-y: auto;
        }

        .result-item {
            padding: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            font-size: 0.9em;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 600;
            color: #2c3e50;
            flex: 0 0 auto;
        }

        .result-value {
            font-family: 'Courier New', monospace;
            color: #2c3e50;
            background: white;
            padding: 4px 8px;
            border-radius: 4px;
            word-break: break-all;
            flex: 1;
            text-align: right;
            margin-left: 10px;
            font-size: 0.85em;
        }

        /* æ‰¹é‡æŸ¥è¯¢éƒ¨åˆ† */
        .batch-section {
            background: transparent;
            padding: 0;
            border-radius: 0;
            box-shadow: none;
        }

        .batch-section h2 {
            display: none;
        }

        .batch-section h3 {
            display: none;
        }

        .batch-section > p {
            margin-bottom: 15px;
            color: #666;
            font-size: 0.9em;
        }

        textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
            box-sizing: border-box;
            background: #f9fafb;
            transition: all 0.3s ease;
            color: #2c3e50;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: stretch;
            margin: 15px 0;
            flex-wrap: nowrap;
        }

        .controls .btn {
            padding: 10px 15px;
            font-size: 0.9em;
            width: 100%;
        }

        .controls label {
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .results {
            margin-top: 15px;
        }

        .results h3 {
            display: none;
        }

        .stats {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 10px;
            color: white;
            font-size: 0.85em;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #fff;
        }

        .stat-label {
            font-size: 0.8em;
            opacity: 0.9;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 11px;
            background: white;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        .results-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .results-table th {
            padding: 10px 6px;
            text-align: left;
            font-weight: 600;
            border-bottom: none;
        }

        .results-table td {
            padding: 8px 6px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
            color: #2c3e50;
            word-break: break-word;
            font-size: 10px;
        }

        .results-table tbody tr:hover {
            background: #f5f7fa;
        }

        /* API æ–‡æ¡£éƒ¨åˆ† */
        .api-section {
            background: transparent;
            padding: 0;
            border-radius: 0;
            margin: 0;
            box-shadow: none;
        }

        .api-section h2 {
            display: none;
        }

        .api-section h3 {
            font-size: 0.95em;
            color: #667eea;
            margin: 12px 0 8px 0;
            font-weight: 700;
        }

        .api-section h4 {
            font-size: 0.85em;
            color: #2c3e50;
            margin: 8px 0 5px 0;
        }

        .endpoint {
            background: #f5f7fa;
            padding: 8px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            margin: 8px 0;
            border-left: 3px solid #667eea;
            color: #2c3e50;
            overflow-x: auto;
            font-size: 0.8em;
            word-break: break-all;
        }

        .example {
            background: #f9fafb;
            border: 1px solid #e9ecef;
            padding: 10px;
            border-radius: 6px;
            margin: 8px 0;
            transition: all 0.3s ease;
        }

        .example:hover {
            border-color: #667eea;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.1);
        }

        .example pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 11px;
            line-height: 1.4;
            margin: 5px 0 0 0;
        }

        .api-section ul {
            list-style: none;
            padding: 0;
            font-size: 0.85em;
            color: #2c3e50;
        }

        .api-section li {
            padding: 5px 0;
            display: flex;
            align-items: flex-start;
        }

        .api-section li::before {
            content: 'â€¢';
            color: #667eea;
            font-weight: bold;
            margin-right: 8px;
        }

        .api-section code {
            background: #f5f7fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #667eea;
            font-size: 0.9em;
        }

        @media (max-width: 1400px) {
            .modules-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 900px) {
            .modules-grid {
                grid-template-columns: 1fr;
            }
        }
        .status-success {
            color: #27ae60;
            font-weight: bold;
            background: #d4edda;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .status-error {
            color: #e74c3c;
            font-weight: bold;
            background: #f8d7da;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .loading {
            text-align: center;
            padding: 30px;
            color: #666;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-left: 10px;
            border: 3px solid #e9ecef;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* IP è¯¦æƒ…æ¨¡æ€æ¡†æ ·å¼ */
        .ip-detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .ip-detail-content {
            background: white;
            border-radius: 12px;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .ip-detail-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .ip-detail-close:hover {
            background: #f0f0f0;
            color: #333;
        }

        .ip-detail-title {
            padding: 20px;
            border-bottom: 2px solid #f0f0f0;
            font-size: 18px;
            font-weight: bold;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ip-detail-source {
            font-size: 12px;
            color: #999;
            font-weight: normal;
        }

        .ip-detail-section {
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
        }

        .ip-detail-section:last-child {
            border-bottom: none;
        }

        .ip-detail-section-title {
            font-size: 14px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .ip-detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f5f5f5;
            font-size: 13px;
        }

        .ip-detail-item:last-child {
            border-bottom: none;
        }

        .ip-detail-label {
            font-weight: 600;
            color: #555;
            min-width: 100px;
        }

        .ip-detail-value {
            flex: 1;
            text-align: right;
            color: #2c3e50;
            word-break: break-word;
        }

        .ip-detail-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
        }

        .badge-success { background: #d4edda; color: #155724; }
        .badge-info { background: #d1ecf1; color: #0c5460; }
        .badge-warning { background: #fff3cd; color: #856404; }
        .badge-danger { background: #f8d7da; color: #721c24; }
        .badge-high { background: #f8d7da; color: #721c24; }
        .badge-elevated { background: #fff3cd; color: #856404; }
        .badge-low { background: #d1ecf1; color: #0c5460; }
        .badge-verylow { background: #d4edda; color: #155724; }
        .badge-critical { background: #8B0000; color: white; }

        .score-help-icon {
            display: inline-block;
            width: 18px;
            height: 18px;
            line-height: 18px;
            text-align: center;
            background: #667eea;
            color: white;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            margin-left: 5px;
            transition: all 0.2s ease;
        }

        .score-help-icon:hover {
            background: #764ba2;
            transform: scale(1.1);
        }

        .score-tooltip {
            display: none;
            position: fixed;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            min-width: 280px;
            max-width: 400px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            z-index: 10001;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .score-tooltip.show {
            display: block;
            opacity: 1;
        }

        .tooltip-header {
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .tooltip-title {
            font-weight: bold;
            color: #333;
            font-size: 13px;
        }

        .tooltip-section {
            margin-bottom: 12px;
            font-size: 12px;
        }

        .tooltip-section:last-child {
            margin-bottom: 0;
        }

        .tooltip-section-title {
            font-weight: bold;
            color: #555;
            margin-bottom: 8px;
        }

        .formula-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 11px;
        }

        .formula-name {
            min-width: 60px;
            color: #666;
        }

        .formula-equation code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #667eea;
        }

        .risk-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .risk-list li {
            padding: 4px 0;
            color: #666;
            font-size: 11px;
        }

        .risk-list li::before {
            content: 'â€¢ ';
            color: #667eea;
            margin-right: 4px;
        }

        .success-text { color: #28a745; }
        .warning-text { color: #ffc107; }
        .danger-text { color: #dc3545; }

        .ip-type-residential { color: #28a745; background: #d4edda; padding: 2px 6px; border-radius: 3px; }
        .ip-type-hosting { color: #ffc107; background: #fff3cd; padding: 2px 6px; border-radius: 3px; }
        .ip-type-business { color: #17a2b8; background: #d1ecf1; padding: 2px 6px; border-radius: 3px; }
        .ip-type-unknown { color: #999; }

        /* Toast é€šçŸ¥æ ·å¼ */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .toast.show {
            opacity: 1;
        }

        .error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            padding: 18px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 5px solid #dc3545;
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.1);
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            border-radius: 3px;
        }

        /* ç½‘ç»œä¿¡æ¯æ£€æµ‹éƒ¨åˆ† */
        .network-info-section {
            background: transparent;
            padding: 0;
            border-radius: 0;
            box-shadow: none;
        }

        .network-info-section h2 {
            display: none;
        }

        .network-info-section > p {
            display: none;
        }

        .network-info-section .description {
            display: none;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 15px;
        }

        .info-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 8px;
            padding: 12px;
            border-left: 3px solid #667eea;
            transition: all 0.3s ease;
        }

        .info-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.15);
        }

        .card-title {
            display: flex;
            align-items: center;
            font-size: 0.9em;
            font-weight: 700;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .card-icon {
            font-size: 1.2em;
            margin-right: 8px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            align-items: center;
            font-size: 0.8em;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: #555;
        }

        .info-value {
            font-weight: 700;
            color: #2c3e50;
            word-break: break-all;
        }

        /* ç½‘ç»œå¡ç‰‡æ ·å¼ */
        .port-info {
            margin-top: 0;
            padding: 0;
        }

        .port-info > h3 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .network-cards-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 10px;
        }

        .network-card {
            background: rgba(255, 255, 255, 0.6);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.08), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            position: relative;
            border-left: 4px solid transparent;
        }

        .network-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(250, 171, 65, 0.1), transparent);
            transition: left 0.5s;
        }

        .network-card:hover {
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.12), 0 0 12px rgba(250, 171, 65, 0.08);
            transform: translateY(-4px);
            border-left-color: #faab41;
        }

        .network-card:hover::before {
            left: 100%;
        }

        .network-card-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #333;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: none;
        }

        .status-indicator.status-loading {
            background-color: #ffa500;
            box-shadow: 0 0 5px #ffa500;
            animation: pulse 1.5s infinite;
        }

        .status-indicator.status-success {
            background-color: #4caf50;
            box-shadow: 0 0 5px #4caf50;
        }

        .status-indicator.status-error {
            background-color: #f44336;
            box-shadow: 0 0 5px #f44336;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .network-info-content {
            padding-left: 0;
        }

        .ip-text {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            word-break: break-all;
            margin-bottom: 8px;
            cursor: default;
            transition: all 0.2s;
            display: block;
        }

        .ip-text.clickable {
            cursor: pointer;
            color: #2196F3;
        }

        .ip-text.clickable:hover {
            color: #1976D2;
        }

        .ip-text .error {
            color: #f44336;
            font-size: 14px;
        }

        .location-text {
            display: flex;
            gap: 15px;
            margin-bottom: 8px;
            font-size: 14px;
            color: #666;
        }

        .country-text,
        .city-text {
            flex: 1;
        }

        .network-tip {
            font-size: 12px;
            color: #999;
            margin-top: 8px;
        }

        .loading-spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #2196F3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 8px;
            vertical-align: middle;
        }

        @media (max-width: 1024px) {
            .network-cards-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .network-cards-container {
                grid-template-columns: 1fr;
            }
        }

        code {
            font-family: 'Courier New', monospace;
            background: white;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 0.75em;
            margin-left: 8px;
        }

        .description {
            background: linear-gradient(135deg, #e7f3ff 0%, #f0f7ff 100%);
            border-left: 5px solid #667eea;
            padding: 20px;
            margin: 25px 0;
            border-radius: 8px;
            color: #2c3e50;
            font-size: 0.95em;
            line-height: 1.7;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        footer {
            text-align: center;
            margin-top: 60px;
            padding: 40px 20px;
            color: #666;
            font-size: 0.95em;
        }

        .github-corner {
            position: absolute;
            top: 0;
            right: 0;
            z-index: 10;
        }

        .github-corner svg {
            fill: #667eea;
            color: white;
            border: 0;
            width: 80px;
            height: 80px;
            transition: all 0.3s ease;
        }

        .github-corner:hover svg {
            fill: #764ba2;
        }

        .github-corner:hover .octo-arm {
            animation: octocat-wave 560ms ease-in-out;
        }

        @keyframes octocat-wave {
            0%, 100% { transform: rotate(0); }
            20%, 60% { transform: rotate(-25deg); }
            40%, 80% { transform: rotate(10deg); }
        }

        @media (max-width: 768px) {
            .header {
                padding: 20px 30px;
            }

            .header h1 {
                font-size: 2.2em;
            }

            .header p {
                font-size: 1em;
            }

            .modules-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .module-header {
                padding: 15px;
            }

            .module-header h3 {
                font-size: 1.1em;
            }

            .module-content {
                padding: 20px;
            }

            .query-section, .batch-section, .network-info-section {
                padding: 0;
            }

            .query-input {
                flex-direction: column;
            }

            .query-input input {
                width: 100%;
            }

            .result-label {
                flex: 0 0 auto;
                min-width: 60px;
            }

            .result-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .result-value {
                margin-top: 6px;
                width: 100%;
                text-align: left;
            }

            .stats {
                flex-direction: column;
                gap: 10px;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .controls {
                flex-direction: column;
            }

            .controls .btn {
                width: 100%;
                text-align: center;
            }

            .github-corner svg {
                width: 60px;
                height: 60px;
            }

            .results-table th,
            .results-table td {
                padding: 6px 4px;
                font-size: 10px;
            }

            .endpoint {
                font-size: 0.75em;
            }

            .example pre {
                font-size: 9px;
            }
        }
    </style>
    </style>
</head>

<body>
    <a href="https://github.com/hafrey1/GeoLite-API" target="_blank" class="github-corner" aria-label="View source on Github">
        <svg viewBox="0 0 250 250" aria-hidden="true">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
            <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
                fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
            <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
                fill="currentColor" class="octo-body"></path>
        </svg>
    </a>

    <div class="container">
        <div class="header">
            <h1>ğŸŒ GeoLite API</h1>
            <p>æ”¯æŒå•ä¸ªæŸ¥è¯¢ â€¢ æ‰¹é‡å¤„ç† â€¢ ç½‘ç»œæ£€æµ‹ </p>
        </div>

        <!-- æ¨¡å—å¸ƒå±€ -->
        <div class="modules-grid">
            <!-- å½“å‰ç½‘ç»œä¿¡æ¯æ¨¡å— -->
            <div class="module">
                <div class="module-header">
                    <h3>ğŸŒ å½“å‰ç½‘ç»œä¿¡æ¯</h3>
                </div>
                <div class="module-content">
                    <div class="port-info">
                        <div class="network-cards-container">
                            <div class="network-card">
                                <div class="network-card-title">
                                    <span class="status-indicator" id="status-ipip"></span>
                                    å›½å†…æµ‹è¯•
                                </div>
                                <div class="network-info-content">
                                    <span id="ipip-ip" class="ip-text">-</span>
                                    <div class="location-text">
                                        <span id="ipip-country" class="country-text">-</span>
                                    </div>
                                    <div class="network-tip">Â· æ‚¨è®¿é—®å›½å†…ç«™ç‚¹æ‰€ä½¿ç”¨çš„IP</div>
                                </div>
                            </div>

                            <div class="network-card">
                                <div class="network-card-title">
                                    <span class="status-indicator" id="status-edgeone"></span>
                                    å›½å¤–æµ‹è¯•
                                </div>
                                <div class="network-info-content">
                                    <span id="edgeone-ip" class="ip-text">-</span>
                                    <div class="location-text">
                                        <span id="edgeone-country" class="country-text">-</span>
                                    </div>
                                    <div class="network-tip">Â· æ‚¨è®¿é—®æ²¡æœ‰è¢«å°çš„å›½å¤–ç«™ç‚¹æ‰€ä½¿ç”¨çš„IP</div>
                                </div>
                            </div>

                            <div class="network-card">
                                <div class="network-card-title">
                                    <span class="status-indicator" id="status-cf"></span>
                                    CloudFlare(ProxyIP)
                                </div>
                                <div class="network-info-content">
                                    <span id="cf-ip" class="ip-text">-</span>
                                    <div class="location-text">
                                        <span id="cf-country" class="country-text">-</span>
                                    </div>
                                    <div class="network-tip">Â· æ‚¨è®¿é—®CFCDNç«™ç‚¹æ‰€ä½¿ç”¨çš„è½åœ°IP</div>
                                </div>
                            </div>

                            <div class="network-card">
                                <div class="network-card-title">
                                    <span class="status-indicator" id="status-twitter"></span>
                                    Twitter/X
                                </div>
                                <div class="network-info-content">
                                    <span id="twitter-ip" class="ip-text">-</span>
                                    <div class="location-text">
                                        <span id="twitter-country" class="country-text">-</span>
                                    </div>
                                    <div class="network-tip">Â· æ‚¨è®¿é—®Twitter(x.com)æ‰€ä½¿ç”¨çš„IP</div>
                                </div>
                            </div>
                        </div>
                        <small style="font-size: 12px; color: #9ca3af; margin-top: 6px; display: block;">ğŸ’¡ <b>å›½å†…æµ‹è¯•</b> æ˜¯ç”±æ‚¨æ¢¯å­çš„ <b>åˆ†æµè§„åˆ™</b> å†³å®šçš„ï¼Œ<b>å›½å¤–æµ‹è¯•</b> æ˜¯ç”±æ‚¨çš„ <b>ä¼˜é€‰IP</b> å†³å®šçš„ï¼Œè€Œ <b>CFã€Twitterã€ChatGPT</b> æ˜¯ç”±æ‚¨çš„ <b>PROXYIP</b> å†³å®šçš„ã€‚</small>
                    </div>
                </div>
            </div>

            <!-- æ‰¹é‡æŸ¥è¯¢æ¨¡å— -->
            <div class="module">
                <div class="module-header">
                    <h3>ğŸ” å•ä¸ª/æ‰¹é‡æŸ¥è¯¢</h3>
                </div>
                <div class="module-content">
                    <div class="batch-section">
                        <p>æ‰¹é‡æŸ¥è¯¢å¤šä¸ªIPæˆ–åŸŸå</p>
                        <textarea id="batchInput" placeholder="æ¯è¡Œä¸€ä¸ªIP/åŸŸå"></textarea>

                        <div class="controls">
                            <button class="btn" onclick="startBatchQuery()" id="queryBtn">å¼€å§‹æŸ¥è¯¢</button>
                            <label style="margin: 0;">
                                <input type="checkbox" id="exportCsv"> å¯¼å‡ºCSV
                            </label>
                        </div>

                        <div class="results" id="batchResults" style="display: none;">
                            <div id="progressBar" class="progress-bar" style="display: none;">
                                <div id="progressFill" class="progress-fill"></div>
                            </div>
                            <div class="stats" id="stats"></div>
                            <div id="resultsContent"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- APIæ–‡æ¡£æ¨¡å— -->
            <div class="module">
                <div class="module-header">
                    <h3>ğŸ“š APIæ–‡æ¡£</h3>
                </div>
                <div class="module-content">
                    <div class="api-section">
                <h2>ğŸ“¡ APIæ¥å£</h2>
                <h3>1. å•ä¸ªæŸ¥è¯¢æ¥å£</h3>
                <div class="endpoint">GET /api/query?input={IPæˆ–åŸŸå}</div>
                <div class="endpoint">POST /api/query</div>
                <div class="example">
                    <h4>è¯·æ±‚ç¤ºä¾‹ï¼š</h4>
                    <pre>curl "https://your-domain.vercel.app/api/query?input=8.8.8.8"
curl "https://your-domain.vercel.app/api/query?input=google.com"</pre>
                </div>
                <div class="example">
                    <h4>å“åº”ç¤ºä¾‹ï¼š</h4>
                    <pre>{
  "success": true,
  "data": {
    "input": "8.8.8.8",
    "type": "ip",
    "ip": "8.8.8.8",
    "country_code": "US",
    "country_name": "ç¾å›½",
    "continent_code": "NA",
    "continent_name": "åŒ—ç¾æ´²",
    "status": "success"
  },
  "timestamp": "2024-01-01T00:00:00.000Z"
}</pre>
                </div>

                <h3>2. æ‰¹é‡æŸ¥è¯¢æ¥å£</h3>
                <div class="endpoint">POST /api/batch</div>
                
                <div class="example">
                    <h4>è¯·æ±‚ç¤ºä¾‹ï¼š</h4>
                    <pre>curl -X POST "https://your-domain.vercel.app/api/batch" \
  -H "Content-Type: application/json" \
  -d '{
    "inputs": ["8.8.8.8", "google.com", "1.1.1.1", "github.com"],
    "format": "json"
  }'</pre>
                </div>
            </div>

            <div class="api-section">
                <h2>ğŸ“Š å“åº”å­—æ®µè¯´æ˜</h2>
                <ul>
                    <li><code>input</code>: è¾“å…¥çš„IPåœ°å€æˆ–åŸŸå</li>
                    <li><code>type</code>: è¾“å…¥ç±»å‹ï¼ˆip/domain/invalidï¼‰</li>
                    <li><code>ip</code>: æŸ¥è¯¢çš„IPåœ°å€</li>
                    <li><code>resolved_ip</code>: åŸŸåè§£æåçš„IPåœ°å€</li>
                    <li><code>country_code</code>: å›½å®¶ä»£ç ï¼ˆISO 3166-1 alpha-2ï¼‰</li>
                    <li><code>country_name</code>: å›½å®¶åç§°ï¼ˆä¸­æ–‡/è‹±æ–‡ï¼‰</li>
                    <li><code>continent_code</code>: æ´²ä»£ç </li>
                    <li><code>continent_name</code>: æ´²åç§°</li>
                    <li><code>status</code>: æŸ¥è¯¢çŠ¶æ€ï¼ˆsuccess/error/not_foundï¼‰</li>
                </ul>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; margin: 40px 0; padding: 30px 0; border-top: 2px solid rgba(102, 126, 234, 0.2);">
                <div style="text-align: center;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">ğŸ“Š æ•°æ®æº</h4>
                    <p style="font-size: 0.9em;">MaxMind GeoLite2-Country.mmdb</p>
                </div>
                <div style="text-align: center;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">âš¡ æ€§èƒ½</h4>
                    <p style="font-size: 0.9em;">æ¯«ç§’çº§æŸ¥è¯¢å“åº”</p>
                </div>
                <div style="text-align: center;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">ğŸš€ éƒ¨ç½²</h4>
                    <p style="font-size: 0.9em;">Vercel æ— æœåŠ¡å™¨</p>
                </div>
            </div>
            <p style="border-top: 1px solid rgba(0,0,0,0.1); padding-top: 20px;">Â© 2024 GeoLite API - Powered by MaxMind GeoLite2 Database</p>
        </footer>
    </div>

    <script>
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        // ===== å•ä¸ªæŸ¥è¯¢åŠŸèƒ½ =====
        async function querySingle() {
            const input = document.getElementById('singleInput').value.trim();
            if (!input) {
                alert('è¯·è¾“å…¥IPåœ°å€æˆ–åŸŸå');
                return;
            }

            const resultDiv = document.getElementById('singleResult');
            resultDiv.innerHTML = '<div class="loading">ğŸ” æŸ¥è¯¢ä¸­...</div>';

            try {
                const response = await fetch(`/api/query?input=${encodeURIComponent(input)}`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                if (data.success && data.data.status === 'success') {
                    resultDiv.innerHTML = `
                        <div class="query-result">
                            <div class="result-item">
                                <span class="result-label">è¾“å…¥ï¼š</span>
                                <span class="result-value">${data.data.input}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">ç±»å‹ï¼š</span>
                                <span class="result-value">${data.data.type}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">IP åœ°å€ï¼š</span>
                                <span class="result-value">${data.data.ip || data.data.resolved_ip}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">å›½å®¶ï¼š</span>
                                <span class="result-value">${data.data.country_name || '-'}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">å›½å®¶ä»£ç ï¼š</span>
                                <span class="result-value">${data.data.country_code || '-'}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">å¤§æ´²ï¼š</span>
                                <span class="result-value">${data.data.continent_name || '-'}</span>
                            </div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">âŒ æŸ¥è¯¢å¤±è´¥ï¼š${data.data.message || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ æŸ¥è¯¢å¤±è´¥ï¼š${error.message}</div>`;
            }
        }

        // ==================== ç½‘ç»œä¿¡æ¯ç›¸å…³å‡½æ•° ====================

        // è®¾ç½®çŠ¶æ€æŒ‡ç¤ºå™¨
        function setStatus(id, status) {
            const indicator = document.getElementById(id);
            if (indicator) {
                indicator.className = 'status-indicator status-' + status;
            }
        }

        // æ˜¾ç¤º toast é€šçŸ¥
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // å°†å¸ƒå°”å€¼è½¬æ¢ä¸º emoji
        function boolToEmoji(value, trueEmoji = 'âœ…', falseEmoji = 'âŒ') {
            return value ? trueEmoji : falseEmoji;
        }

        // å°† IP ç±»å‹è½¬æ¢ä¸ºä¸­æ–‡å¹¶æ·»åŠ æ ·å¼
        function formatIpType(type) {
            if (!type) return '<span class="ip-type-unknown">æœªçŸ¥</span>';
            const typeMap = {
                'isp': { text: 'ä½å®…', class: 'ip-type-residential' },
                'hosting': { text: 'æœºæˆ¿', class: 'ip-type-hosting' },
                'business': { text: 'å•†ç”¨', class: 'ip-type-business' }
            };
            const typeInfo = typeMap[type.toLowerCase()] || { text: type, class: 'ip-type-unknown' };
            return `<span class="${typeInfo.class}">${typeInfo.text}</span>`;
        }

        // è·å–å¨èƒç­‰çº§çš„æ ·å¼ç±»
        function getThreatBadgeClass(score) {
            if (!score) return 'badge-info';
            const numScore = parseFloat(score);
            if (numScore < 0.001) return 'badge-success';
            if (numScore < 0.01) return 'badge-info';
            if (numScore < 0.1) return 'badge-warning';
            return 'badge-danger';
        }

        // è®¡ç®—ç»¼åˆæ»¥ç”¨è¯„åˆ†
        function calculateAbuseScore(companyScore, asnScore, securityFlags = {}) {
            if (!companyScore || companyScore === 'æœªçŸ¥') companyScore = 0;
            if (!asnScore || asnScore === 'æœªçŸ¥') asnScore = 0;
            const company = parseFloat(companyScore) || 0;
            const asn = parseFloat(asnScore) || 0;
            let baseScore = ((company + asn) / 2) * 5;
            let riskAddition = 0;
            const riskFlags = [
                securityFlags.is_crawler,
                securityFlags.is_proxy,
                securityFlags.is_vpn,
                securityFlags.is_tor,
                securityFlags.is_abuser,
                securityFlags.is_bogon
            ];
            const riskCount = riskFlags.filter(flag => flag === true).length;
            riskAddition = riskCount * 0.15;
            const finalScore = baseScore + riskAddition;
            if (baseScore === 0 && riskAddition === 0) return null;
            return finalScore;
        }

        // è·å–æ»¥ç”¨è¯„åˆ†çš„é¢œè‰²ç­‰çº§
        function getAbuseScoreBadgeClass(percentage) {
            if (percentage === null || percentage === undefined) return 'badge-info';
            if (percentage >= 100) return 'badge-critical';
            if (percentage >= 20) return 'badge-high';
            if (percentage >= 5) return 'badge-elevated';
            if (percentage >= 0.25) return 'badge-low';
            return 'badge-verylow';
        }

        // æ ¼å¼åŒ–æ»¥ç”¨è¯„åˆ†ä¸ºç™¾åˆ†æ¯”
        function formatAbuseScorePercentage(score) {
            if (score === null || score === undefined) return 'æœªçŸ¥';
            const percentage = score * 100;
            return percentage.toFixed(2) + '%';
        }

        // åˆ‡æ¢è¯„åˆ†ç®—æ³•è¯´æ˜æ°”æ³¡
        function toggleScoreTooltip(helpIcon) {
            const tooltip = helpIcon.nextElementSibling;
            const isShowing = tooltip.classList.contains('show');
            document.querySelectorAll('.score-tooltip.show').forEach(t => {
                if (t !== tooltip) t.classList.remove('show');
            });
            tooltip.classList.toggle('show');
            if (!isShowing) {
                setTimeout(() => {
                    positionTooltipNearMouse(tooltip, helpIcon);
                    const closeTooltip = (e) => {
                        if (!tooltip.contains(e.target) && !helpIcon.contains(e.target)) {
                            tooltip.classList.remove('show');
                            document.removeEventListener('click', closeTooltip);
                        }
                    };
                    document.addEventListener('click', closeTooltip);
                }, 100);
            }
        }

        // å°†æ°”æ³¡ä½ç½®è®¾ç½®åœ¨é¼ æ ‡é™„è¿‘
        function positionTooltipNearMouse(tooltip, helpIcon) {
            const iconRect = helpIcon.getBoundingClientRect();
            const tooltipWidth = tooltip.offsetWidth;
            const tooltipHeight = tooltip.offsetHeight;
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            const padding = 10;
            let left = iconRect.right + padding;
            let top = iconRect.top - tooltipHeight / 2;
            if (left + tooltipWidth > windowWidth - padding) {
                left = iconRect.left - tooltipWidth - padding;
            }
            if (top < padding) {
                top = iconRect.top + padding;
            }
            if (top + tooltipHeight > windowHeight - padding) {
                top = windowHeight - tooltipHeight - padding;
            }
            tooltip.style.position = 'fixed';
            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';
        }

        // æ˜¾ç¤º IP è¯¦æƒ…å¼¹çª—
        function showIpDetailModal(data) {
            const modal = document.createElement('div');
            modal.className = 'ip-detail-modal';
            const companyScore = data.company?.abuser_score;
            const asnScore = data.asn?.abuser_score;
            const securityFlags = {
                is_crawler: data.is_crawler,
                is_proxy: data.is_proxy,
                is_vpn: data.is_vpn,
                is_tor: data.is_tor,
                is_abuser: data.is_abuser,
                is_bogon: data.is_bogon
            };
            const combinedScore = calculateAbuseScore(companyScore, asnScore, securityFlags);
            let riskControlHTML = '';
            if (combinedScore !== null) {
                const scorePercentage = combinedScore * 100;
                const badgeClass = getAbuseScoreBadgeClass(scorePercentage);
                const formattedScore = formatAbuseScorePercentage(combinedScore);
                let riskLevel = '';
                if (scorePercentage >= 100) riskLevel = 'æåº¦å±é™©';
                else if (scorePercentage >= 20) riskLevel = 'é«˜é£é™©';
                else if (scorePercentage >= 5) riskLevel = 'è½»å¾®é£é™©';
                else if (scorePercentage >= 0.25) riskLevel = 'çº¯å‡€';
                else riskLevel = 'æåº¦çº¯å‡€';
                riskControlHTML = `<span class="ip-detail-badge ${badgeClass}">${formattedScore} ${riskLevel}</span>`;
            } else {
                riskControlHTML = 'æœªçŸ¥';
            }
            let detailHTML = `<div class="ip-detail-content"><button class="ip-detail-close" onclick="this.closest('.ip-detail-modal').remove()">Ã—</button><div class="ip-detail-title">ğŸ” IP è¯¦ç»†ä¿¡æ¯<span class="ip-detail-source">æ•°æ®æ¥æº: ipapi.is</span></div>`;
            detailHTML += `<div class="ip-detail-section"><div class="ip-detail-section-title">ğŸ“ åŸºæœ¬ä¿¡æ¯</div><div class="ip-detail-item"><span class="ip-detail-label">IP åœ°å€</span><span class="ip-detail-value">${data.ip || 'æœªçŸ¥'}</span></div><div class="ip-detail-item"><span class="ip-detail-label">åŒºåŸŸäº’è”ç½‘æ³¨å†Œæœºæ„</span><span class="ip-detail-value">${data.rir || 'æœªçŸ¥'}</span></div><div class="ip-detail-item"><span class="ip-detail-label">è¿è¥å•† / ASN ç±»å‹</span><span class="ip-detail-value">${formatIpType(data.company?.type)} / ${formatIpType(data.asn?.type)}</span></div><div class="ip-detail-item"><span class="ip-detail-label">ç»¼åˆæ»¥ç”¨è¯„åˆ†<span class="score-help-icon" onclick="event.stopPropagation(); toggleScoreTooltip(this);" title="ç‚¹å‡»æŸ¥çœ‹ç®—æ³•è¯´æ˜">?</span><span class="score-tooltip"><div class="tooltip-header"><span class="tooltip-title">ğŸ“Š ç»¼åˆæ»¥ç”¨è¯„åˆ†ç®—æ³•</span></div><div class="tooltip-section"><p class="tooltip-section-title">è¯„åˆ†å…¬å¼</p><div class="formula-item"><span class="formula-name">åŸºç¡€åˆ†</span><span class="formula-equation"><code>(è¿è¥å•†åˆ† + ASNåˆ†) / 2 * 5</code></span></div><div class="formula-item"><span class="formula-name">é£é™©é™„åŠ </span><span class="formula-equation"><code>é£é™©é¡¹æ•°é‡ * 15%</code></span></div></div><div class="tooltip-section"><p class="tooltip-section-title">å®‰å…¨é£é™©é¡¹</p><ul class="risk-list"><li>çˆ¬è™« (Crawler)</li><li>ä»£ç† (Proxy)</li><li>VPN</li><li>Tor ç½‘ç»œ</li><li>æ»¥ç”¨IP (Abuser)</li><li>è™šå‡IP (Bogon)</li></ul></div></span></span><span class="ip-detail-value">${riskControlHTML}</span></div></div>`;
            detailHTML += `<div class="ip-detail-section"><div class="ip-detail-section-title">ğŸ›¡ï¸ å®‰å…¨æ£€æµ‹</div><div class="ip-detail-item"><span class="ip-detail-label">ç§»åŠ¨ç½‘ç»œ</span><span class="ip-detail-value">${data.is_mobile ? '<span class="success-text">ğŸ“± æ˜¯</span>' : 'å¦'}</span></div><div class="ip-detail-item"><span class="ip-detail-label">æ•°æ®ä¸­å¿ƒ</span><span class="ip-detail-value">${data.is_datacenter ? '<span class="warning-text">ğŸ¢ æ˜¯</span>' : 'å¦'}</span></div><div class="ip-detail-item"><span class="ip-detail-label">å«æ˜Ÿç½‘ç»œ</span><span class="ip-detail-value">${data.is_satellite ? '<span class="success-text">ğŸ›°ï¸ æ˜¯</span>' : 'å¦'}</span></div><div class="ip-detail-item"><span class="ip-detail-label">çˆ¬è™«</span><span class="ip-detail-value">${data.is_crawler ? '<span class="danger-text">ğŸ¤– æ˜¯</span>' : 'âœ… å¦'}</span></div><div class="ip-detail-item"><span class="ip-detail-label">ä»£ç†æœåŠ¡å™¨</span><span class="ip-detail-value">${data.is_proxy ? '<span class="danger-text">âš ï¸ æ˜¯</span>' : 'âœ… å¦'}</span></div><div class="ip-detail-item"><span class="ip-detail-label">VPN</span><span class="ip-detail-value">${data.is_vpn ? '<span class="danger-text">âš ï¸ æ˜¯</span>' : 'âœ… å¦'}</span></div><div class="ip-detail-item"><span class="ip-detail-label">Tor ç½‘ç»œ</span><span class="ip-detail-value">${data.is_tor ? '<span class="danger-text">âš ï¸ æ˜¯</span>' : 'âœ… å¦'}</span></div><div class="ip-detail-item"><span class="ip-detail-label">æ»¥ç”¨ IP</span><span class="ip-detail-value">${data.is_abuser ? '<span class="danger-text">âš ï¸ æ˜¯</span>' : 'âœ… å¦'}</span></div><div class="ip-detail-item"><span class="ip-detail-label">è™šå‡ IP</span><span class="ip-detail-value">${data.is_bogon ? '<span class="danger-text">âš ï¸ æ˜¯</span>' : 'âœ… å¦'}</span></div></div>`;
            if (data.location) {
                detailHTML += `<div class="ip-detail-section"><div class="ip-detail-section-title">ğŸŒ ä½ç½®ä¿¡æ¯</div><div class="ip-detail-item"><span class="ip-detail-label">å›½å®¶</span><span class="ip-detail-value">${data.location.country || 'æœªçŸ¥'} (${data.location.country_code || '-'})</span></div>${data.location.state ? `<div class="ip-detail-item"><span class="ip-detail-label">çœä»½/å·</span><span class="ip-detail-value">${data.location.state}</span></div>` : ''}${data.location.city ? `<div class="ip-detail-item"><span class="ip-detail-label">åŸå¸‚</span><span class="ip-detail-value">${data.location.city}</span></div>` : ''}${data.location.zip ? `<div class="ip-detail-item"><span class="ip-detail-label">é‚®ç¼–</span><span class="ip-detail-value">${data.location.zip}</span></div>` : ''}${data.location.latitude && data.location.longitude ? `<div class="ip-detail-item"><span class="ip-detail-label">åæ ‡</span><span class="ip-detail-value">${data.location.latitude}, ${data.location.longitude}</span></div>` : ''}${data.location.timezone ? `<div class="ip-detail-item"><span class="ip-detail-label">æ—¶åŒº</span><span class="ip-detail-value">${data.location.timezone}</span></div>` : ''}${data.location.local_time ? `<div class="ip-detail-item"><span class="ip-detail-label">å½“åœ°æ—¶é—´</span><span class="ip-detail-value">${data.location.local_time}</span></div>` : ''}<div class="ip-detail-item"><span class="ip-detail-label">æ¬§ç›Ÿæˆå‘˜</span><span class="ip-detail-value">${boolToEmoji(data.location.is_eu_member, 'ğŸ‡ªğŸ‡º æ˜¯', 'å¦')}</span></div></div>`;
            }
            if (data.company) {
                const abuserScore = data.company.abuser_score || 'æœªçŸ¥';
                const badgeClass = getThreatBadgeClass(abuserScore);
                detailHTML += `<div class="ip-detail-section"><div class="ip-detail-section-title">ğŸ¢ è¿è¥å•†ä¿¡æ¯</div><div class="ip-detail-item"><span class="ip-detail-label">è¿è¥å•†åç§°</span><span class="ip-detail-value">${data.company.name || 'æœªçŸ¥'}</span></div>${data.company.domain ? `<div class="ip-detail-item"><span class="ip-detail-label">åŸŸå</span><span class="ip-detail-value">${data.company.domain}</span></div>` : ''}<div class="ip-detail-item"><span class="ip-detail-label">ç±»å‹</span><span class="ip-detail-value">${data.company.type || 'æœªçŸ¥'}</span></div>${data.company.network ? `<div class="ip-detail-item"><span class="ip-detail-label">ç½‘ç»œèŒƒå›´</span><span class="ip-detail-value">${data.company.network}</span></div>` : ''}<div class="ip-detail-item"><span class="ip-detail-label">æ»¥ç”¨è¯„åˆ†</span><span class="ip-detail-value"><span class="ip-detail-badge ${badgeClass}">${abuserScore}</span></span></div></div>`;
            }
            if (data.asn) {
                const asnAbuserScore = data.asn.abuser_score || 'æœªçŸ¥';
                const asnBadgeClass = getThreatBadgeClass(asnAbuserScore);
                detailHTML += `<div class="ip-detail-section"><div class="ip-detail-section-title">ğŸ”¢ ASN ä¿¡æ¯</div><div class="ip-detail-item"><span class="ip-detail-label">ASN ç¼–å·</span><span class="ip-detail-value">AS${data.asn.asn || 'æœªçŸ¥'}</span></div>${data.asn.org ? `<div class="ip-detail-item"><span class="ip-detail-label">ç»„ç»‡</span><span class="ip-detail-value">${data.asn.org}</span></div>` : ''}${data.asn.route ? `<div class="ip-detail-item"><span class="ip-detail-label">è·¯ç”±</span><span class="ip-detail-value">${data.asn.route}</span></div>` : ''}${data.asn.type ? `<div class="ip-detail-item"><span class="ip-detail-label">ç±»å‹</span><span class="ip-detail-value">${data.asn.type}</span></div>` : ''}<div class="ip-detail-item"><span class="ip-detail-label">æ»¥ç”¨è¯„åˆ†</span><span class="ip-detail-value"><span class="ip-detail-badge ${asnBadgeClass}">${asnAbuserScore}</span></span></div>${data.asn.country ? `<div class="ip-detail-item"><span class="ip-detail-label">å›½å®¶ä»£ç </span><span class="ip-detail-value">${data.asn.country.toUpperCase()}</span></div>` : ''}</div>`;
            }
            if (data.abuse) {
                detailHTML += `<div class="ip-detail-section"><div class="ip-detail-section-title">ğŸ“§ æ»¥ç”¨ä¸¾æŠ¥è”ç³»æ–¹å¼</div>${data.abuse.name ? `<div class="ip-detail-item"><span class="ip-detail-label">è”ç³»äºº</span><span class="ip-detail-value">${data.abuse.name}</span></div>` : ''}${data.abuse.email ? `<div class="ip-detail-item"><span class="ip-detail-label">é‚®ç®±</span><span class="ip-detail-value">${data.abuse.email}</span></div>` : ''}${data.abuse.phone ? `<div class="ip-detail-item"><span class="ip-detail-label">ç”µè¯</span><span class="ip-detail-value">${data.abuse.phone}</span></div>` : ''}${data.abuse.address ? `<div class="ip-detail-item"><span class="ip-detail-label">åœ°å€</span><span class="ip-detail-value">${data.abuse.address}</span></div>` : ''}</div>`;
            }
            detailHTML += `</div>`;
            modal.innerHTML = detailHTML;
            modal.addEventListener('click', function (e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            const closeHandler = function (e) {
                if (e.key === 'Escape') {
                    modal.remove();
                    document.removeEventListener('keydown', closeHandler);
                }
            };
            document.addEventListener('keydown', closeHandler);
            document.body.appendChild(modal);
        }

        // ===== æ‰¹é‡æŸ¥è¯¢åŠŸèƒ½ =====
        let currentResults = null;

        function loadSampleData() {
            const sampleData = `google.com
cloudflare.com
baidu.com
114.114.114.114
github.com
youtube.com
facebook.com
twitter.com
208.67.222.222
amazon.com
microsoft.com
apple.com
35.221.254.236
35.220.133.61
34.146.177.122
35.200.143.183
34.87.56.130
34.101.103.120
35.197.161.138
34.116.167.55
35.228.114.153
34.51.134.45
34.51.138.174
34.175.139.26
35.205.33.30
35.187.27.174
34.89.121.226
35.197.249.117
35.204.79.99
34.154.228.146
35.203.42.193
35.203.18.247
34.130.100.152
34.51.23.163
34.51.22.207
35.199.77.203
35.198.52.22
34.176.217.158
34.72.28.29`;
            document.getElementById('batchInput').value = sampleData;
        }

        function showProgress() {
            document.getElementById('progressBar').style.display = 'block';
            animateProgress();
        }

        function animateProgress() {
            const progressFill = document.getElementById('progressFill');
            let width = 0;
            const interval = setInterval(() => {
                if (width >= 90) {
                    clearInterval(interval);
                } else {
                    width += Math.random() * 10;
                    progressFill.style.width = width + '%';
                }
            }, 200);
        }

        function hideProgress() {
            document.getElementById('progressBar').style.display = 'none';
            document.getElementById('progressFill').style.width = '0%';
        }

        async function startBatchQuery() {
            const inputText = document.getElementById('batchInput').value.trim();
            if (!inputText) {
                alert('è¯·è¾“å…¥IPåœ°å€æˆ–åŸŸå');
                return;
            }

            const queryBtn = document.getElementById('queryBtn');
            const resultsDiv = document.getElementById('batchResults');

            queryBtn.disabled = true;
            queryBtn.innerHTML = 'â³ æŸ¥è¯¢ä¸­...';
            resultsDiv.style.display = 'block';
            showProgress();

            document.getElementById('resultsContent').innerHTML = 
                '<div class="loading">ğŸ” æ­£åœ¨æ‰¹é‡æŸ¥è¯¢ä¸­ï¼Œè¯·ç¨å€™...</div>';

            try {
                const inputs = inputText.split('\n')
                    .map(line => line.trim())
                    .filter(line => line);
                    
                const exportCsv = document.getElementById('exportCsv').checked;

                const response = await fetch('/api/batch', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        inputs: inputs,
                        format: exportCsv ? 'csv' : 'json'
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                if (exportCsv) {
                    const csvData = await response.text();
                    const blob = new Blob([csvData], { type: 'text/csv' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `geoip-results-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.csv`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);

                    document.getElementById('resultsContent').innerHTML = 
                        '<div class="loading">âœ… CSVæ–‡ä»¶å·²ä¸‹è½½å®Œæˆï¼</div>';
                } else {
                    const data = await response.json();
                    if (data.success) {
                        currentResults = data;
                        displayBatchResults(data);
                    } else {
                        throw new Error(data.message || data.error || 'æŸ¥è¯¢å¤±è´¥');
                    }
                }
            } catch (error) {
                console.error('æŸ¥è¯¢é”™è¯¯:', error);
                document.getElementById('resultsContent').innerHTML =
                    `<div class="error">âŒ æŸ¥è¯¢å¤±è´¥ï¼š${error.message}</div>`;
            } finally {
                queryBtn.disabled = false;
                queryBtn.innerHTML = 'ğŸš€ å¼€å§‹æ‰¹é‡æŸ¥è¯¢';
                hideProgress();
            }
        }

        function displayBatchResults(data) {
            const stats = data.stats || data.statistics || {};
            const results = data.data || [];

            document.getElementById('stats').innerHTML = `
                <div class="stat-item">
                    <div class="stat-value">${stats.total || results.length}</div>
                    <div>æ€»æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" style="color: #28a745;">${stats.success || 0}</div>
                    <div>æˆåŠŸ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" style="color: #dc3545;">${stats.error || 0}</div>
                    <div>å¤±è´¥</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.processing_time || stats.processing_time_ms || '0'}ms</div>
                    <div>å¤„ç†æ—¶é—´</div>
                </div>
            `;

            let tableHTML = `
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>è¾“å…¥</th>
                            <th>ç±»å‹</th>
                            <th>IPåœ°å€</th>
                            <th>å›½å®¶</th>
                            <th>å›½å®¶ä»£ç </th>
                            <th>æ´²ä»£ç </th>
                            <th>çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            results.forEach((result, index) => {
                const statusClass = result.status === 'success' ? 'status-success' : 'status-error';
                const ip = result.ip || result.resolved_ip || '-';

                tableHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${result.input}</td>
                        <td>${result.type || 'unknown'}</td>
                        <td>${ip}</td>
                        <td>${result.country_name || '-'}</td>
                        <td>${result.country_code || '-'}</td>
                        <td>${result.continent_code || '-'}</td>
                        <td class="${statusClass}">${result.status || 'error'}</td>
                    </tr>
                `;
            });

            tableHTML += `</tbody></table>`;
            document.getElementById('resultsContent').innerHTML = tableHTML;
        }

        function clearBatchResults() {
            document.getElementById('batchInput').value = '';
            document.getElementById('batchResults').style.display = 'none';
            currentResults = null;
            hideProgress();
        }

        // ===== æ–°ç½‘ç»œå¡ä¿¡æ¯æ£€æµ‹åŠŸèƒ½ =====
        // è®¾ç½®çŠ¶æ€æŒ‡ç¤ºå™¨
        function setNetworkStatus(id, status) {
            const indicator = document.getElementById(id);
            if (indicator) {
                indicator.className = 'status-indicator';
                if (status === 'loading') {
                    indicator.classList.add('status-loading');
                } else if (status === 'success') {
                    indicator.classList.add('status-success');
                } else if (status === 'error') {
                    indicator.classList.add('status-error');
                }
            }
        }


        // ==================== é€šç”¨å·¥å…·å‡½æ•° ====================

// è¶…æ—¶ Promise
function withTimeout(ms, promise) {
    return Promise.race([
        promise,
        new Promise((_, reject) => setTimeout(() => reject(new Error("è¯·æ±‚è¶…æ—¶")), ms))
    ]);
}

// å®‰å…¨ JSON è§£æ
async function safeJson(response) {
    try {
        return await response.json();
    } catch {
        return null;
    }
}

// UI æ›´æ–°
function setResult(idIp, idCountry, ip, country) {
    document.getElementById(idIp).textContent = ip || "æœªçŸ¥";
    document.getElementById(idCountry).textContent = country || "";
}


// ==================== å›½å†… IPï¼šå¤š API è½®è¯¢ ====================
async function fetchIpipData() {
    setStatus("status-ipip", "loading");

    const titleEl = document.querySelector("#status-ipip")?.parentElement;

    const apiList = [
        {
            name: "speedtest.cn",
            url: "https://api-v3.speedtest.cn/ip",
            parser: (json) => {
                if (json?.code === 0) {
                    return {
                        ip: json.data.ip,
                        country: json.data.country,
                        city: json.data.city
                    };
                }
                return null;
            }
        },
        {
            name: "ipipv.com",
            url: "https://myip.ipipv.com/",
            parser: (json) => ({
                ip: json?.Ip,
                country: json?.Country,
                city: json?.City
            })
        },
        {
            name: "ipip.net",
            url: "https://myip.ipip.net/json",
            parser: (json) => {
                if (json?.ret === "ok") {
                    return {
                        ip: json.data.ip,
                        country: json.data.location?.[0],
                        city: json.data.location?.[2]
                    };
                }
                return null;
            }
        }
    ];

    for (const api of apiList) {
        try {
            const fullUrl = api.url + (api.url.includes("?") ? "&" : "?") + `_t=${Date.now()}`;

            const response = await withTimeout(3000, fetch(fullUrl));
            const json = await safeJson(response);

            const result = api.parser(json);

            if (result?.ip) {
                setResult("ipip-ip", "ipip-country", result.ip, `${result.country || ""} ${result.city || ""}`);
                setStatus("status-ipip", "success");

                if (titleEl) {
                    titleEl.innerHTML = `<span class="status-indicator" id="status-ipip"></span>å›½å†…æµ‹è¯•(${api.name})`;
                    setStatus("status-ipip", "success");
                }

                console.log(`å›½å†… API ä½¿ç”¨ï¼š${api.name}`);
                return;
            }
        } catch (err) {
            console.warn(`${api.name} API å¤±è´¥:`, err);
        }
    }

    // å…¨éƒ¨å¤±è´¥
    document.getElementById("ipip-ip").innerHTML = `<span class="error">åŠ è½½å¤±è´¥</span>`;
    document.getElementById("ipip-country").textContent = "";
    setStatus("status-ipip", "error");
}



// ==================== å›½å¤– IP ====================
async function fetchEdgeOneData() {
    setStatus("status-edgeone", "loading");

    try {
        const response = await withTimeout(
            3000,
            fetch(`https://api.ipapi.cmliussss.net`)
        );
        const data = await safeJson(response);

        const ip = data?.ip;
        const country = data?.location?.country_code;
        const asn = data?.asn?.asn;
        const org = data?.asn?.org;

        if (ip) {
            setResult("edgeone-ip", "edgeone-country", ip, `${country || ""} AS${asn || ""} ${org || ""}`);
            setStatus("status-edgeone", "success");
        } else {
            throw new Error("ç»“æ„é”™è¯¯");
        }

    } catch (err) {
        document.getElementById("edgeone-ip").innerHTML = `<span class="error">åŠ è½½å¤±è´¥</span>`;
        document.getElementById("edgeone-country").textContent = "";
        setStatus("status-edgeone", "error");
        console.error("EdgeOne é”™è¯¯: ", err);
    }
}



// ==================== Cloudflare ====================
async function fetchCloudFlareData() {
    setStatus("status-cf", "loading");

    try {
        const response = await withTimeout(
            3000,
            fetch(`https://cf.090227.xyz/ip.json?_t=${Date.now()}`)
        );
        const data = await safeJson(response);

        if (data?.ip) {
            setResult("cf-ip", "cf-country", data.ip, `${data.country || ""} ${data.org || ""}`);
            setStatus("status-cf", "success");
        } else {
            throw new Error("ç»“æ„é”™è¯¯");
        }

    } catch (err) {
        document.getElementById("cf-ip").innerHTML = `<span class="error">åŠ è½½å¤±è´¥</span>`;
        document.getElementById("cf-country").textContent = "";
        setStatus("status-cf", "error");
        console.error("Cloudflare é”™è¯¯:", err);
    }
}



// ==================== Twitter / X ====================
async function fetchTwitterData() {
    setStatus("status-twitter", "loading");

    try {
        const response = await withTimeout(
            3000,
            fetch(`https://x.com/cdn-cgi/trace?_t=${Date.now()}`, {
                redirect: "follow"
            })
        );

        const raw = await response.text();
        const data = {};

        raw.split("\n").forEach((line) => {
            const [k, v] = line.split("=");
            if (k && v) data[k.trim()] = v.trim();
        });

        if (data.ip) {
            setResult("twitter-ip", "twitter-country", data.ip, `${data.loc || ""} ${data.colo || ""}`);
            setStatus("status-twitter", "success");
        } else {
            throw new Error("è§£æå¤±è´¥");
        }

    } catch (err) {
        document.getElementById("twitter-ip").innerHTML = `<span class="error">åŠ è½½å¤±è´¥</span>`;
        document.getElementById("twitter-country").textContent = "";
        setStatus("status-twitter", "error");
        console.error("Twitter å…¥å£é”™è¯¯:", err);
    }
}


        // ä½¿IPå¯ç‚¹å‡»ï¼Œæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
        function makeIpClickable(elementId, ip) {
            const element = document.getElementById(elementId);
            if (element && ip !== '-' && ip !== 'è·å–å¤±è´¥') {
                element.style.cursor = 'pointer';
                element.style.color = '#2196F3';
                element.onclick = function(e) {
                    e.stopPropagation();
                    fetchIpDetails(ip);
                };
            }
        }

        // è·å–IPè¯¦ç»†ä¿¡æ¯å¹¶æ˜¾ç¤ºæ¨¡æ€æ¡†
        async function fetchIpDetails(ip) {
            try {
                // ä½¿ç”¨ ipapi.is è·å–è¯¦ç»†ä¿¡æ¯
                const response = await fetch(`https://api.ipapi.is/?q=${ip}`);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.error) {
                        showToast('æ— æ³•è·å–IPè¯¦ç»†ä¿¡æ¯ï¼š' + (data.error_message || 'æœªçŸ¥é”™è¯¯'));
                        return;
                    }
                    
                    // å°† ipapi.is çš„å“åº”æ˜ å°„åˆ° showIpDetailModal æœŸæœ›çš„æ ¼å¼
                    const displayData = {
                        ip: data.ip,
                        rir: data.rir || 'æœªçŸ¥',
                        is_mobile: data.is_mobile,
                        is_datacenter: data.is_datacenter,
                        is_satellite: data.is_satellite,
                        is_crawler: data.is_crawler,
                        is_proxy: data.is_proxy,
                        is_vpn: data.is_vpn,
                        is_tor: data.is_tor,
                        is_abuser: data.is_abuser,
                        is_bogon: data.is_bogon,
                        
                        // ä½ç½®ä¿¡æ¯
                        location: {
                            country: data.location?.country,
                            country_code: data.location?.country_code,
                            state: data.location?.state,
                            city: data.location?.city,
                            zip: data.location?.zip,
                            latitude: data.location?.latitude,
                            longitude: data.location?.longitude,
                            timezone: data.location?.timezone,
                            local_time: data.location?.local_time,
                            is_eu_member: data.location?.is_eu_member
                        },
                        
                        // è¿è¥å•†ä¿¡æ¯
                        company: {
                            name: data.company?.name,
                            domain: data.company?.domain,
                            type: data.company?.type,
                            network: data.company?.network,
                            abuser_score: data.company?.abuser_score
                        },
                        
                        // ASN ä¿¡æ¯
                        asn: {
                            asn: data.asn?.asn,
                            org: data.asn?.org,
                            route: data.asn?.route,
                            type: data.asn?.type,
                            country: data.asn?.country,
                            abuser_score: data.asn?.abuser_score
                        },
                        
                        // æ»¥ç”¨ä¸¾æŠ¥ä¿¡æ¯
                        abuse: {
                            name: data.abuse?.name,
                            email: data.abuse?.email,
                            phone: data.abuse?.phone,
                            address: data.abuse?.address
                        }
                    };
                    
                    showIpDetailModal(displayData);
                } else {
                    showToast('æ— æ³•è·å–IPè¯¦ç»†ä¿¡æ¯');
                }
            } catch (error) {
                console.error('è·å–IPè¯¦æƒ…å¤±è´¥:', error);
                showToast('è·å–IPè¯¦æƒ…å¤±è´¥ï¼š' + error.message);
            }
        }

        // åŠ è½½æ‰€æœ‰ç½‘ç»œä¿¡æ¯
        async function loadNetworkCards() {
            try {
                await Promise.all([
                    fetchIpipData(),        // å›½å†… IP
                    fetchEdgeOneData(),     // å›½å¤– IP
                    fetchCloudFlareData(),  // Cloudflare
                    fetchTwitterData()      // Twitter/X
                ]);
            } catch (error) {
                console.error('åŠ è½½ç½‘ç»œä¿¡æ¯å‡ºé”™:', error);
            }
        }


        // ===== ç½‘ç»œä¿¡æ¯æ£€æµ‹åŠŸèƒ½ =====
        async function detectNetworkInfo() {
            const content = document.getElementById('networkContent');
            content.innerHTML = `
                <div class="loading">
                    <div style="font-size: 2em; margin-bottom: 10px;">â³</div>
                    <p>æ­£åœ¨è·å–ç½‘ç»œä¿¡æ¯...</p>
                </div>
            `;

            try {
                const response = await fetch('/api/network-info', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();

                if (data.success) {
                    renderNetworkInfo(data.data);
                } else {
                    content.innerHTML = '<div class="error">è·å–ç½‘ç»œä¿¡æ¯å¤±è´¥ï¼š' + (data.message || 'æœªçŸ¥é”™è¯¯') + '</div>';
                }
            } catch (error) {
                console.error('é”™è¯¯:', error);
                content.innerHTML = '<div class="error">è·å–ç½‘ç»œä¿¡æ¯å¤±è´¥ï¼š' + error.message + '</div>';
            }
        }

        function renderNetworkInfo(data) {
            const content = document.getElementById('networkContent');

            const testPoints = [
                {
                    key: 'domestic',
                    icon: 'ğŸ‡¨ğŸ‡³',
                    title: 'å›½å†…æµ‹è¯•',
                    description: 'æ‚¨è®¿é—®å›½å†…ç«™ç‚¹æ‰€ä½¿ç”¨çš„IP'
                },
                {
                    key: 'foreign',
                    icon: 'ğŸŒ',
                    title: 'å›½å¤–æµ‹è¯•',
                    description: 'æ‚¨è®¿é—®å›½å¤–ç«™ç‚¹æ‰€ä½¿ç”¨çš„IP'
                },
                {
                    key: 'cloudflare',
                    icon: 'â˜ï¸',
                    title: 'CloudFlare ProxyIP',
                    description: 'æ‚¨è®¿é—®CFCDNç«™ç‚¹æ‰€ä½¿ç”¨çš„è½åœ°IP'
                },
                {
                    key: 'twitter',
                    icon: 'ğ•',
                    title: 'Twitter/X',
                    description: 'æ‚¨è®¿é—®Twitter(x.com)æ‰€ä½¿ç”¨çš„IP'
                }
            ];

            let html = '<div class="info-grid">';

            testPoints.forEach(point => {
                const info = data[point.key];
                let cardHtml = `
                    <div class="info-card">
                        <div class="card-title">
                            <span class="card-icon">${point.icon}</span>
                            <div>
                                <div>${point.title}</div>
                                <div style="font-size: 0.8em; font-weight: 400; color: #999;">${point.description}</div>
                            </div>
                        </div>
                        <div>
                `;

                if (info && info.status === 'success' && info.ip) {
                    // æ„å»º IP è¯¦æƒ…å¡ç‰‡
                    const ipForDisplay = info.ip;
                    const countryName = info.country_name || info.country_code || '-';
                    const countryCode = info.country_code || '-';
                    const continentName = info.continent_name || '-';
                    const sourceUrl = info.source_url ? info.source_url.split('?')[0] : '-';
                    
                    cardHtml += `
                        <div class="info-row">
                            <span class="info-label">IP åœ°å€ï¼š</span>
                            <span class="info-value" style="font-weight: 700; color: #667eea;">${ipForDisplay}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">å›½å®¶/åœ°åŒºï¼š</span>
                            <span class="info-value">${countryName}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">å›½å®¶ä»£ç ï¼š</span>
                            <span class="info-value"><code>${countryCode}</code></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">å¤§æ´²ï¼š</span>
                            <span class="info-value">${continentName}</span>
                        </div>
                        <div class="info-row" style="font-size: 0.85em; color: #999; border-top: 1px solid #eee; padding-top: 8px; margin-top: 8px;">
                            <span class="info-label">æµ‹è¯•æºï¼š</span>
                            <span class="info-value" style="word-break: break-all; font-size: 0.8em;">${sourceUrl}</span>
                        </div>
                    `;
                } else if (info && info.status === 'failed') {
                    cardHtml += `
                        <div style="color: #f56565; text-align: center; padding: 20px;">
                            <p>âŒ ${info.message || 'æ— æ³•è·å–ä¿¡æ¯'}</p>
                        </div>
                    `;
                } else {
                    cardHtml += `
                        <div style="color: #999; text-align: center; padding: 20px;">
                            <p>â³ æ­£åœ¨æµ‹è¯•...</p>
                        </div>
                    `;
                }

                cardHtml += `</div></div>`;
                html += cardHtml;
            });

            html += '</div>';

            if (data.client_ip && data.client_ip !== 'unknown') {
                html += `
                    <div class="description" style="margin-top: 20px; padding: 15px; background: #f0f4ff; border-left: 4px solid #667eea; border-radius: 4px;">
                        <p style="margin: 0;">
                            <strong>ğŸ“¡ æ‚¨çš„ç›´è¿ IPï¼š</strong> 
                            <code style="background: white; padding: 2px 6px; border-radius: 3px; font-weight: 700; color: #667eea;">${data.client_ip}</code>
                            <small style="color: #999; margin-left: 10px;">(æœåŠ¡å™¨ç«¯æ£€æµ‹åˆ°çš„æ‚¨çš„æºIP)</small>
                        </p>
                    </div>
                `;
            }

            content.innerHTML = html;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æµ‹ç½‘ç»œä¿¡æ¯
        window.addEventListener('load', function() {
            detectNetworkInfo();
            loadNetworkCards();
            loadSampleData();
        });
    </script>
</body>
</html>
